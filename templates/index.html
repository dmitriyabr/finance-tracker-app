<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—á–µ—Ç–æ–≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">üí∞ Finance Tracker</h1>
        
        <!-- –û–±—â–∏–π –±–∞–ª–∞–Ω—Å -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                        <h3>–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</h3>
                        <h2 class="display-4">
                            ${{ "{:,.2f}".format(total_balance_usd) }}
                            {% if total_balance_change %}
                                <span class="balance-change {{ 'text-success' if total_balance_change > 0 else 'text-danger' }}">
                                    {{ '‚ÜóÔ∏è' if total_balance_change > 0 else '‚ÜòÔ∏è' }}
                                </span>
                            {% endif %}
                        </h2>
                        {% if last_updated %}
                        <small>–û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ last_updated[:10] }}</small>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤–∞–ª—é—Ç–∞–º</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="currencyChart" width="400" height="300"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üìà –î–∏–Ω–∞–º–∏–∫–∞ –æ–±—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ (USD)</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="totalBalanceChart" width="400" height="300"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üì± –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç</h5>
                    </div>
                    <div class="card-body">
                        <form id="imageForm" enctype="multipart/form-data">
                            <div class="mb-3">
                                <input type="file" class="form-control" id="imageInput" name="image" accept="image/*" required>
                            </div>
                            <button type="submit" class="btn btn-primary">üîç –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –±–∞–ª–∞–Ω—Å</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>–í—Å–µ–≥–æ —Å—á–µ—Ç–æ–≤:</strong> {{ total_count }}</p>
                        <p><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> 
                            {% if last_updated %}
                                {{ last_updated[:19].replace('T', ' ') }}
                            {% else %}
                                –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—á–µ—Ç–∞ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>üè¶ –í–∞—à–∏ —Å—á–µ—Ç–∞</h5>
                    </div>
                    <div class="card-body">
                        {% if accounts %}
                            <div class="row" id="accountsContainer">
                                {% for account_id, account in accounts.items() %}
                                <div class="col-md-6 col-lg-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h6 class="card-title">{{ account.name }}</h6>
                                            <div class="balance-info">
                                                <div class="usd-balance">
                                                    <strong>${{ "%.2f"|format(account.balance_usd) }}</strong>
                                                </div>
                                                <div class="local-balance text-muted">
                                                    <small>{{ "%.2f"|format(account.balance) }} {{ account.currency }}</small>
                                                </div>
                                            </div>
                                            {% if account.last_updated %}
                                            <small class="text-muted">
                                                –û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ account.last_updated[:10] }}
                                            </small>
                                            {% endif %}
                                            <div class="mt-2">
                                                <button class="btn btn-sm btn-outline-primary" 
                                                        onclick="showAccountHistory('{{ account_id }}')">
                                                    üìä –ò—Å—Ç–æ—Ä–∏—è
                                                </button>
                                                <button class="btn btn-sm btn-outline-info" 
                                                        onclick="showAccountChart('{{ account_id }}')">
                                                    üìà –ì—Ä–∞—Ñ–∏–∫
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="text-center text-muted">
                                <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å—á–µ—Ç–æ–≤.</p>
                                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π —Å—á–µ—Ç!</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ -->
        <div id="resultContainer" class="mt-4" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h5>üîç –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è</h5>
                </div>
                <div class="card-body" id="resultContent">
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Å—á–µ—Ç–∞ -->
    <div class="modal fade" id="accountHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üìä –ò—Å—Ç–æ—Ä–∏—è —Å—á–µ—Ç–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="accountHistoryContent">
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ —Å—á–µ—Ç–∞ -->
    <div class="modal fade" id="accountChartModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üìà –ì—Ä–∞—Ñ–∏–∫ —Å—á–µ—Ç–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <canvas id="accountChart" width="600" height="400"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
    <script>
        window.accountsData = {{ accounts_json | safe }};
    </script>
    
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html> 